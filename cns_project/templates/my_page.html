{% extends 'base.html' %}
{% load bootstrap5 %}
{% load static %}
{% block title %} Final Good {% endblock %}
{% block content %}

    <div class="container-fluid  " style="background-color:#B7AC44;">
        <div class="row ">
            <div class="col-2  bg-dark text-muted min-vh-100">
                <ul class="nav nav-pills d-flex flex-column text-start">
                    <li class="raw_report">
                       <a href="#" class="nav-link">Raw Material reports</a>
                   </li>
                    <li class="product_report">
                       <a href="#" class="nav-link">Production reports</a>
                   </li>
                </ul>
            </div>
            <div class="raw_section col-10   text-center">
                <h1>Raw Material</h1>
                <hr>

                <div class="row ">
                    <div class="col-4 text-center">
                        <div class="row ">
                            <input type="button" class="bg-success today-btn btn border my-1 mx-1" value="Today">
                        </div>
                        <div class="row">
                            <input type="button" class="bg-success last-week-btn btn border my-1 mx-1" value="Last Week">
                        </div>
                        <div class="row">
                            <input type="button" class="bg-success last-month-btn btn border my-1 mx-1" value="Last month">
                        </div>

                    </div>
                    <div class="col-8 ">
                        <div class="row">
                            <form class="form" method="POST">
                                {% csrf_token %}
                                <div class="input-group my-2">
                                    <span class="input-group-text" id="icon1">Start date</span>
                                    <input type="date" class="from_date form-control" id="inputWithIcon1"
                                           onfocus="this.max=new Date().toISOString().split('T')[0]"
                                           placeholder="from Date" name="from_date" aria-describedby="icon2" required>
                                </div>
                                <div class="input-group my-2">
                                    <span class="input-group-text" id="icon2">Last date  </span>
                                    <input type="date" class="to_date form-control" id="inputWithIcon2"
                                           onfocus="this.max=new Date().toISOString().split('T')[0]"
                                           placeholder="To Date" name="to_date" aria-describedby="icon2" required>
                                </div>

                                <input class="apply btn btn-dark text-muted" type="submit" value="Apply">
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row raw_data ">
                    <div class="d-flex mx-2 my-2">
                        <div class="table-responsive text-nowrap bg-info" id="myt" style="overflow:scroll; max-height:400px;">
                            <table class=" table table-striped" id="raw_table">
                                <thead class="sticky-top bg-dark text-muted">
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Raw RST</th>
                                        <th scope="col">Raw Weight</th>
                                        <th scope="col">Raw Rate</th>
                                        <th scope="col">Total  </th>
                                        <th scope="col">Created at </th>
                                        <th scope="col">Updated at </th>
                                    </tr>
                                </thead>
                                {% for obj in data %}
                                    <tbody class="">
                                        <tr>
                                            <th scope="row" class="text-light">{{forloop.counter}}</th>
                                            <td id="raw_rst" class="text-light">{{obj.rst_no}}</td>
                                            <td id="raw_weight" class="text-light">{{obj.net_wt}}</td>
                                            <td id="raw_rate" class="text-light">{{obj.rate}}</td>
                                            <td id="raw_total" class="text-light">{{obj.total}}</td>
                                            <td id="raw_created" class="text-light">{{obj.created_at |date:"d-m-y H:i:s A"}}</td>
                                            <td class="text-light">{{obj.updated_at |date:"d-m-y H:i:s A"}}</td>
                                        </tr>
                                    </tbody>
                                {% endfor %}
                            </table>
                        </div>
                        <div class="data-cards mx-2 my-2">
                            <div class="card mx-2 my-2">
                                <div class="card-body">
                                    <div class="card-title">Date Range</div><hr>
                                    <div class="card-text">
                                        <p id="date_range">Date range will be show here...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card mx-2 my-2">
                                <div class="card-body">
                                    <div class="card-title">Analysis</div><hr>
                                    <div class="card-text">
                                        <p>Total report will be shown here...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="savePdfBtn">Save Table Data as PDF</button>

            </div>

            <div class="product_section col-10 h-25 bg-warning text-center">
                <h1>Production Material</h1>
                <div class="row bg-success">
                    <div class="col-4">
                                hello
                    </div>
                    <div class="col-8 bg-primary">
                        helo
                    </div>
                </div>
            </div>
        </div>
    </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
<script src="https://rawgit.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>


<script>
        $(document).ready(function () {
            $(".product_section").hide();
            $(".raw_section").show();
            $(".raw_report").click(function() {
                $(".product_section").hide();
                $(".raw_section").show();
            });
            $(".product_report").click(function() {
                $(".raw_section").hide();
                $(".product_section").show();
            });

            $(".today-btn").click(function() {
                // Get the current date
                const currentDate = new Date();
                console.log(currentDate.getFullYear() + '/' + currentDate.getMonth() + 1 +'/'+currentDate.getDate());
                console.log(currentDate.getMonth() + 1);
                console.log(currentDate.getDate());

                // Format the date as YYYY-MM-DD (required format for input type="date")
                const formattedDate = currentDate.getFullYear() + '-' +
                                      (currentDate.getMonth() + 1).toString().padStart(2, '0') + '-' +
                                      currentDate.getDate().toString().padStart(2, '0');
                console.log(formattedDate);

                // Set the formatted date as the value of the date field
                $('.from_date').val(formattedDate);
                $('.from_date').prop('min', formattedDate);
                $('.to_date').val(formattedDate);
                $('.to_date').prop('min', formattedDate);
            });


            $(".last-week-btn").click(function() {
                 const currentDate = new Date();
                 const formattedDate = currentDate.getFullYear() + '-' +
                                      (currentDate.getMonth() + 1).toString().padStart(2, '0') + '-' +
                                      currentDate.getDate().toString().padStart(2, '0');
                 const lastWeekStartDate = new Date(currentDate);
                 lastWeekStartDate.setDate(currentDate.getDate() - 6); // Subtract 6 days for a week
                 const formattedLastWeekStartDate = lastWeekStartDate.toISOString().split('T')[0];

                // Set the formatted date as the value of the date field
                $('.from_date').val(formattedLastWeekStartDate);
                $('.to_date').val(formattedDate);  // Assuming the "to_date" field is for the end date

            });

            $(".last-month-btn").click(function() {
                 const currentDate = new Date();
                 const formattedDate = currentDate.getFullYear() + '-' +
                                      (currentDate.getMonth() + 1).toString().padStart(2, '0') + '-' +
                                      currentDate.getDate().toString().padStart(2, '0');
                 const lastMonthStartDate = new Date(currentDate);
                 lastMonthStartDate.setMonth(currentDate.getMonth() - 1); // Subtract 1 month
                 const formattedLastMonthStartDate = lastMonthStartDate.toISOString().split('T')[0];


                // Set the formatted date as the value of the date field
                $('.from_date').val(formattedLastMonthStartDate);
                $('.to_date').val(formattedDate);  // Assuming the "to_date" field is for the end date

            });

               $('#savePdfBtn').click(function () {
                        var check_visible = "";
                        if ($('.raw_section').is(':visible')) {
                            console.log('The section is visible.');
                            check_visible = "raw_material";
                        } else {
                            console.log('The section is hidden.');
                            check_visible = "product_material";
                        }
                        $.ajax({
                            url: '/get_data/',
                            method: 'GET',
                            data: {
                                check: check_visible,
                                start_date: $(".from_date").val(),
                                end_date: $(".to_date").val()
                            },
                            success: function (data) {

                                console.log(data);
                            },
                            error: function (error) {
                                console.error('Error exporting filtered data:', error);
                            }
                        });



                });

        var start_date = "{{ start_date }}";
        var last_date = "{{ last_date }}";

         $('#date_range').text('From: ' + start_date );
         $('#date_range').append('<br> To:         ' + last_date);



        });
    </script>


{% endblock %}