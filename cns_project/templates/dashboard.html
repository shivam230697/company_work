{% extends 'base.html' %}
{% load bootstrap5 %}
{% load static %}
{% block title %} Dashboard {% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<div class="container-fluid">
    <div class="row flex-nowrap">

        <div class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-dark">
            <div class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 text-white min-vh-100">

                <a href="/" class="d-flex align-items-center pb-3 mb-md-0 me-md-auto text-white text-decoration-none">
                    <span class="fs-5 d-none d-sm-inline">Dashboard</span>
                </a>

                <ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start" id="menu">
                    <li>
                        <a href="#" class="nav-link px-0 align-middle">
                            <i class="fs-4 bi-table"></i> <span class="ms-1 d-none d-sm-inline">Reports</span></a>
                    </li>






                    <!-- <li>
                        <a href="#submenu3" data-bs-toggle="collapse" class="nav-link px-0 align-middle">
                            <i class="fs-4 bi-grid"></i> <span class="ms-1 d-none d-sm-inline">Products</span> </a>
                            <ul class="collapse nav flex-column ms-1" id="submenu3" data-bs-parent="#menu">
                            <li class="w-100">
                                <a href="#" class="nav-link px-0"> <span class="d-none d-sm-inline">Product</span> 1</a>
                            </li>
                            <li>
                                <a href="#" class="nav-link px-0"> <span class="d-none d-sm-inline">Product</span> 2</a>
                            </li>
                            <li>
                                <a href="#" class="nav-link px-0"> <span class="d-none d-sm-inline">Product</span> 3</a>
                            </li>
                            <li>
                                <a href="#" class="nav-link px-0"> <span class="d-none d-sm-inline">Product</span> 4</a>
                            </li>
                        </ul>
                    </li> -->
                </ul>
                <hr>

            </div>
        </div>

        <div class="col py-3">
            <form method="post" class="post-form" action="{% url 'dashboard' %}">
                {% csrf_token%}

                <!-- Input with Icon 1 -->
                <div class="mb-3">
                    <div class="input-group">
                        <span class="input-group-text" id="icon1">From</span>
                        <input type="date" class="form-control" id="inputWithIcon1"
                               onfocus="this.max=new Date().toISOString().split('T')[0]"
                               placeholder="Username" name="from_date" aria-describedby="icon1" required>
                    </div>
                </div>

                <!-- Input with Icon 2 -->
                <div class="mb-3">
                    <div class="input-group">
                        <span class="input-group-text" id="icon2">To</span>
                        <input type="date" class="form-control" id="inputWithIcon2"
                               onfocus="this.max=new Date().toISOString().split('T')[0]"
                               placeholder="Password" name="to_date" aria-describedby="icon2" required>
                    </div>
                </div>

                <div class="d-flex flex-row">

                    <div class="mb-3 px-2" >
                        <input type="submit"
                               style="background-color: #C5AA6A; border: 1px solid black; border-radius: 5px; "
                               name="report_button" value="show production report">
                    </div>

                    <div class="mb-3 px-2">
                        <input type="submit"
                               style="background-color: #C5AA6A; border: 1px solid black; border-radius: 5px; "
                               name="report_button" value="show raw material report">
                    </div>
                </div>
            </form>
                <br>

            <div class="d-flex  flex-row " id="d1">

                {% if btn_name == 'show production report'%}
                <table id="pt" class=" table   table-striped table-bordered mt-2  text-center align-middle"
                       style="background-color: #4c3c3c; border: 2px solid black; border-radius: 10px;">
                    <thead>
                        <tr class="align-middle ">
                            <th scope="col" >Serial Number </th>
                            <th scope="col">Production RST</th>
                            <th scope="col">Production Net Weight</th>
                            <th scope="col">Vehicle Number</th>
                            <th scope="col">Created at </th>
                            <th scope="col">Updated at </th>
                        </tr>
                    </thead>
                    {% for obj in data %}
                    <tbody >
                        <tr>
                            <th scope="row" class="text-light">{{obj.pk}}</th>
                            <td id="prst" class="text-light">{{obj.product_rst}}</td>
                            <td id="pntwt" class="text-light">{{obj.product_net_weight}}</td>
                            <td class="text-light">{{obj.vehicle_no}}</td>
                            <td id="created" class="text-light">{{obj.created_at |date:"d-m-y H:i:s A"}}</td>
                            <td class="text-light">{{obj.updated_at |date:"d-m-y H:i:s A"}}</td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
                {% elif btn_name == 'show raw material report' %}

                <table id="rmt" class=" table table-striped table-bordered mt-2 text-center align-middle"
                       style="background-color: #4c3c3c; border: 2px solid black; border-radius: 10px;">
                    <thead>
                        <tr >
                            <th scope="col">Serial Number</th>
                            <th scope="col">Raw RST</th>
                            <th scope="col">Raw Weight</th>
                            <th scope="col">Raw Rate</th>
                            <th scope="col">Total  </th>
                            <th scope="col">Created at </th>
                            <th scope="col">Updated at </th>
                        </tr>
                    </thead>
                    {% for obj in data %}
                    <tbody>
                        <tr>
                            <th scope="row" class="text-light">{{obj.pk}}</th>
                            <td id="rmrst" class="text-light">{{obj.rst_no}}</td>
                            <td id="rntwt" class="text-light">{{obj.net_wt}}</td>
                            <td id="raw_rate" class="text-light">{{obj.rate}}</td>
                            <td id="raw_total" class="text-light">{{obj.total}}</td>
                            <td id="raw_created" class="text-light">{{obj.created_at |date:"d-m-y H:i:s A"}}</td>
                            <td class="text-light">{{obj.updated_at |date:"d-m-y H:i:s A"}}</td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
                {%  endif %}

                <div class="col-auto order-1">
                    <div class="card mt-2 h-60" style="background-color: #4c3c3c; border: 2px solid black; border-radius: 10px;">
                        <div class="card-body">
                            <h5 class="card-title">Date Range</h5> <hr>
                            <p class="card-text text-light" id="date_range">Date range will be show here...</p>
                        </div>
                    </div>

                    <div class="card mt-2 h-60" style="background-color: #4c3c3c; border: 2px solid black; border-radius: 10px;">
                        <div class="card-body">
                            <h5 id="report_total" class="card-title">Report Total</h5> <hr>
                            <p class="card-text text-light" id="pntwt_total">Total report will be shown here...</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>





<script>
    $(document).ready(function () {
        var btnName = "{{ btn_name }}";
        var start_date = "{{ from_date }}";
        var last_date = "{{ to_date }}";
        if ( btnName == 'show production report'){
            calculate_production_total();
        }
        else if (btnName == 'show raw material report') {
            console.log("do somethig else");

            calculate_raw_material();
        }

        function calculate_production_total() {
            var btnName = "{{ btn_name }}";
            console.log(btnName);
            var totalColumn1 = 0;
            var totalColumn2 = 0;
            let values = [];

            // Iterate through each row in the table
            $('#pt tbody tr').each(function () {
                // Get the value of the cells in the respective columns
                var valueColumn1 = parseInt($(this).find('#pntwt').text(), 10) || 0;
                values.push($(this).find('#created').text())
                //var valueColumn2 = parseInt($(this).find('.column2').text(), 10) || 0;

                // Accumulate the values
                totalColumn1 += valueColumn1;
                //totalColumn2 += valueColumn2;
            });

            // Display the total in the respective span elements
            $('#pntwt_total').text('Total net weight: ' + totalColumn1);
            let minDate =  values[0];
            let maxDate = values[values.length - 1];

            $('#date_range').text('From: ' + start_date );
            $('#date_range').append('<br> To:         ' + last_date);


            $('#report_total').text('Production Total');

        }

        function calculate_raw_material() {
            var btnName = "{{ btn_name }}";
            console.log(btnName);
            var totalColumn1 = 0;
            var totalColumn2 = 0;
            var totalColumn3 = 0;
            let values = [];

            // Iterate through each row in the table
            $('#rmt tbody tr').each(function () {
                // Get the value of the cells in the respective columns
                var valueColumn1 = parseInt($(this).find('#rntwt').text(), 10) || 0;
                var valueColumn2 = parseInt($(this).find('#raw_rate').text(), 10) || 0;
                var valueColumn3 = parseInt($(this).find('#raw_total').text(), 10) || 0;
                //values.push($(this).find('#created').text())
                //var valueColumn2 = parseInt($(this).find('.column2').text(), 10) || 0;

                // Accumulate the values
                totalColumn1 += valueColumn1;
                totalColumn2 += valueColumn2;
                totalColumn3 += valueColumn3;
            });

            // Display the total in the respective span elements
            $('#pntwt_total').text('Total net weight: ' + totalColumn1);
            $('#pntwt_total').append('<br>Total Rate: ' + totalColumn2);
            $('#pntwt_total').append('<br>Total Payment: ' + totalColumn3);
            $('#date_range').text('From: ' + start_date );
            $('#date_range').append('<br> To:         ' + last_date);


            $('#report_total').text('Raw Material Total');


        }


    });
</script>


{% endblock %}
